# ğŸ“… Daily Log â€“ 2025-07-08

## âœ… Summary

- ğŸ” Rebuilt full LocalStack environment using Terraform and automated testing via `test-api.sh`.  
- ğŸ“‚ Restructured project folders: separated Lambda code into `lambda/`, Terraform configs into `terraform/`, and ZIP files into consistent deployment paths.  
- âš™ï¸ Updated Terraform files to align with new folder structure:
  - `lambda.tf` for Lambda resources
  - `api_gateway.tf` for all API Gateway resources
  - `iam.tf` for IAM roles and permissions
  - `outputs.tf` for referencing `api_gateway_id` and invoke URL
- ğŸ”Œ Integrated API Gateway with two Lambda functions:
  - `/debug` (test endpoint)
  - `/user` with `POST`, `GET`, and `DELETE` routes backed by DynamoDB
- ğŸ”‘ Created IAM role with `sts:AssumeRole` trust policy for Lambda, and applied `aws_lambda_permission` to allow API Gateway invocations.  
- ğŸ“¦ Packaged Lambda code properly with `index.js` and `node_modules` using `zip -r` from the correct context.  
- ğŸ§ª Validated all API endpoints locally with `curl`:
  - âœ… `/debug`
  - âœ… `POST /user`
  - âœ… `GET /user/{id}`
  - âœ… `DELETE /user/{id}`
- ğŸ§¹ Confirmed DynamoDB operations (create, read, delete) working as expected inside Lambda using `DocumentClient`.  
- ğŸ§ª Script automates apply, test, optional destroy, and `/etc/hosts` patch for local DNS routing.

---

## âš ï¸ Problems Encountered

- âŒ Lambda failed initially due to missing `aws-sdk` â€” fixed by ensuring `node_modules` was zipped correctly.  
- ğŸ” Got 502/internal error responses from API Gateway when Lambda failed to load â€” traced back to packaging issues.  
- ğŸŒ Local DNS resolution failed until correct API hostname was appended to `/etc/hosts` dynamically by the script.  
- ğŸ§¨ Terraform destroy wiped stack after tests â€” later commented out to preserve state during development.

---

## ğŸš€ Next Steps

- ğŸ§± Add `PUT` or `PATCH` support for user updates in the API.  
- ğŸ§ª Expand test script to check for failure cases like invalid input or missing fields.  
- ğŸ“„ Begin full documentation of:
  - API routes and expected request/response schemas
  - Folder structure and Terraform module layout
  - Lambda logic and environment setup  
- â˜ï¸ Prepare remote AWS-compatible version of infrastructure (for actual cloud deployment later).  
- ğŸ” Add fine-grained IAM policies to Lambda roles (e.g., limit to specific table operations).

---

*End of log.*